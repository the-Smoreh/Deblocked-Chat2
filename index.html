<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Chat</title>
<style>
    body {
        background: #f5f5f5;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        padding-top: 40px;
    }

    #chat-container {
        width: 450px;
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    #messages {
        height: 300px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        background: #fafafa;
        margin-bottom: 15px;
    }

    .msg {
        margin-bottom: 10px;
        padding: 6px 10px;
        border-radius: 6px;
        background: #fff;
        border: 1px solid #eee;
        word-wrap: break-word;
    }

    #inputs {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    input, button {
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 15px;
    }

    button {
        background: #4a90e2;
        color: white;
        cursor: pointer;
        border: none;
    }

    button:hover {
        background: #357ac9;
    }
</style>
</head>
<body>

<div id="chat-container">
    <div id="messages"></div>

    <div id="inputs">
        <input id="username" placeholder="Enter username">
        <input id="message" placeholder="Enter message">
        <button id="send">Send</button>
    </div>
</div>

<script>
    // Automatically choose ws:// for local dev, wss:// for production
    const protocol = window.location.protocol === "https:" ? "wss" : "ws";
    const ws = new WebSocket(`${protocol}://${window.location.host}`);

    const messages = document.getElementById("messages");
    const usernameInput = document.getElementById("username");
    const messageInput = document.getElementById("message");
    const sendBtn = document.getElementById("send");

    let usernameLocked = false;

    // Send message
    sendBtn.onclick = () => {
        const username = usernameInput.value.trim();
        const message = messageInput.value.trim();

        if (!username || !message) return;

        if (!usernameLocked) {
            usernameInput.disabled = true;
            usernameLocked = true;
        }

        ws.send(JSON.stringify({ username, message }));
        messageInput.value = "";
        messageInput.focus();
    };

    // Send on Enter key
    messageInput.addEventListener("keydown", e => {
        if (e.key === "Enter") sendBtn.onclick();
    });

    // Receive messages
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        const div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<strong style="color:${data.color}">${data.username}:</strong> ${data.message}`;

        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    };

    // Debug connection status
    ws.onopen = () => console.log("Connected to WebSocket");
    ws.onerror = (err) => console.log("WebSocket error:", err);
    ws.onclose = () => console.log("WebSocket closed");
</script>

</body>
</html>
